<div class="modal-overlay" (click)="cerrarModal()"></div>

<div class="modal-content" (click)="$event.stopPropagation()">
  
  <div class="modal-header">
    <h4 class="modal-title">Editar Servicio</h4>
    <button type="button" class="btn-close" (click)="cerrarModal()"></button>
  </div>

  <div class="modal-body">
    <form #formServicio="ngForm" (ngSubmit)="actualizarServicio(formServicio)">
      
      <div class="row">
        <div class="col-md-6">
          <div class="form-group floating mb-3">
            <input type="text" id="nombreEdit" name="nombreEdit" class="form-control" placeholder=" "
                   [(ngModel)]="servicio.nombre" #nombre="ngModel" required minlength="3">
            <label for="nombreEdit">Nombre del Servicio</label>
            @if (nombre.invalid && nombre.touched) {
              <div class="invalid-feedback">
                @if (nombre.errors?.['required']) { <span>El nombre es requerido.</span> }
                @if (nombre.errors?.['minlength']) { <span>Debe tener al menos 3 caracteres.</span> }
              </div>
            }
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group floating mb-3">
            <select id="categoriaEdit" name="categoriaEdit" class="form-select"
                    [(ngModel)]="servicio.objCategoria" #categoria="ngModel" 
                    [compareWith]="compararCategorias" required>
              <option [ngValue]="null" disabled>Seleccione una categoría</option>
              @for (cat of categorias; track cat.id) {
                <option [ngValue]="cat">{{ cat.nombre }}</option>
              }
            </select>
            <label for="categoriaEdit">Categoría</label>
            @if (categoria.invalid && categoria.touched) {
              <div class="invalid-feedback"><span>Debe seleccionar una categoría.</span></div>
            }
          </div>
        </div>
      </div>

      <div class="form-group floating mb-3">
        <textarea id="descripcionEdit" name="descripcionEdit" class="form-control" rows="3" placeholder=" "
                  [(ngModel)]="servicio.descripcion" #descripcion="ngModel" required></textarea>
        <label for="descripcionEdit">Descripción</label>
        @if (descripcion.invalid && descripcion.touched) {
          <div class="invalid-feedback"><span>La descripción es requerida.</span></div>
        }
      </div>
      
      <div class="row">
        <div class="col-md-4">
          <div class="form-group floating mb-3">
            <input type="number" id="duracionEdit" name="duracionMinutosEdit" class="form-control" placeholder=" " min="10"
                   [(ngModel)]="servicio.duracionMinutos" #duracion="ngModel" required>
            <label for="duracionEdit">Duración (min)</label>
            @if (duracion.invalid && duracion.touched) {
              <div class="invalid-feedback"><span>Mínimo 10 min.</span></div>
            }
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group floating mb-3">
            <input type="number" id="precioEdit" name="precioEdit" class="form-control" placeholder=" " min="0"
                   [(ngModel)]="servicio.precio" #precio="ngModel" required>
            <label for="precioEdit">Precio ($)</label>
            @if (precio.invalid && precio.touched) {
              <div class="invalid-feedback"><span>El precio es requerido.</span></div>
            }
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group floating mb-3">
            <select id="estadoEdit" name="estadoEdit" class="form-select"
                    [(ngModel)]="servicio.estado" #estado="ngModel" required>
              <option value="Activo">Activo</option>
              <option value="Inactivo">Inactivo</option>
            </select>
            <label for="estadoEdit">Estado</label>
          </div>
        </div>
      </div>

      <div class="row align-items-center">
        <div class="col-md-7">
          <div class="form-group mb-3">
            <label for="imagenEdit" class="form-label">Cambiar Imagen</label>
            <input 
              class="form-control" 
              type="file" 
              id="imagenEdit"
              accept="image/*"
              (change)="onFileChange($event)">
            <small class="form-text text-muted">Max 4MB. Si no selecciona una nueva, se conservará la actual.</small>
          </div>
        </div>
        <div class="col-md-5">
          @if (imagePreview()) {
            <div class="image-preview-container">
              <p class="text-muted small mb-1">Vista Previa:</p>
              <img [src]="imagePreview()" class="image-preview" alt="Vista previa">
            </div>
          } @else {
            <div class="image-preview-container placeholder">
              <i class="bi bi-image"></i>
              <p>Sin imagen</p>
            </div>
          }
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cerrarModal()">Cancelar</button>
        <button type="submit" class="btn btn-guardar" [disabled]="formServicio.invalid">
          <i class="bi bi-check-lg me-1"></i> Guardar Cambios
        </button>
      </div>
    </form>
  </div>
</div>
```eof